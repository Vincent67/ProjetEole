<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Connexion à une base de données SQL Azure</title><meta name="Language" content="fr-fr" /><meta name="System.Keywords" content="SQL Azure" /><meta name="Microsoft.Help.Id" content="49645b1f-39b1-4757-bda1-c51ebc375c34" /><meta name="Description" content="Cette rubrique aborde les problèmes rencontrés lors de l'utilisation de Pilote JDBC Microsoft pour SQL Server pour la connexion à une base de données SQL Azure. Pour plus d'informations sur les bases de données SQL Azure, consultez :" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Connexion à une base de données SQL Azure</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Cette rubrique aborde les problèmes rencontrés lors de l'utilisation de Pilote JDBC Microsoft pour SQL Server pour la connexion à une base de données SQL Azure. Pour plus d'informations sur les bases de données SQL Azure, consultez :</p><ul><li><p><a href="http://go.microsoft.com/fwlink/?LinkID=202490">Base de données SQL Azure</a></p></li><li><p><a href="http://msdn.microsoft.com/library/gg715284.aspx">Procédure : connexion à SQL Azure à l'aide de JDBC</a></p></li><li><p><a href="http://msdn.microsoft.com/library/windowsazure/hh749029(VS.103).aspx">Utilisation de SQL Azure dans Java</a></p></li></ul></div><h1 class="heading">Détails</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><dl class="authored"><dt>Dans SQL Azure, il est nécessaire de se connecter à la base de données MASTER pour appeler <span sdata="langKeyword" value="SQLServerDatabaseMetaData.getCatalogs"><span class="keyword">SQLServerDatabaseMetaData.getCatalogs</span></span>.</dt><dd><p>SQL Azure ne prend pas en charge le renvoi de l'intégralité des catalogues d'une base de données utilisateur. <span sdata="langKeyword" value="SQLServerDatabaseMetaData.getCatalogs"><span class="keyword">SQLServerDatabaseMetaData.getCatalogs</span></span> utilise la vue sys.databases pour récupérer les catalogues. Consultez la section Autorisations de la rubrique <a href="http://go.microsoft.com/fwlink/?LinkId=217396">sys.databases (Base de données SQL Azure)</a> pour comprendre le comportement de <span sdata="langKeyword" value="SQLServerDatabaseMetaData.getCatalogs"><span class="keyword">SQLServerDatabaseMetaData.getCatalogs</span></span> dans SQL Azure.</p></dd><dt>Connexions supprimées</dt><dd><p>Lors de la connexion à SQL Azure, les connexions inactives peuvent être arrêtées par un composant réseau (tel un pare-feu) après une période d'inactivité. Pour éviter la suppression des connexions inactives par un composant réseau, les paramètres de registre suivants (ou leurs équivalents non Windows) doivent être définis sur le système d'exploitation dans lequel se trouve le pilote.</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>Paramètre de Registre</p></th><th><p>Valeur recommandée</p></th></tr><tr><td><p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\KeepAliveTime</p></td><td><p>30000</p></td></tr><tr><td><p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\KeepAliveInterval</p></td><td><p>1000</p></td></tr><tr><td><p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\TcpMaxDataRetransmission</p></td><td><p>10</p></td></tr></table></div><p>Vous devez redémarrer l'ordinateur pour appliquer les paramètres de clé de Registre.</p><p>Pour effectuer cela lorsque vous exécutez le système dans Windows Azuren, créez une tâche de démarrage pour ajouter les clés de Registre.  Par exemple, ajoutez la tâche de démarrage suivante au fichier de définition du service :</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;Startup&gt;
    &lt;Task commandLine="AddKeepAlive.cmd" executionContext="elevated" taskType="simple"&gt;
    &lt;/Task&gt;
&lt;/Startup&gt;</pre></span></div><p>Puis ajoutez un fichier AddKeepAlive.cmd à votre projet. Définissez le paramètre « Copier dans le répertoire de sortie » sur « Toujours copier ». Voici un exemple de fichier AddKeepAlive.cmd :</p><div class="sampleCode"><span codeLanguage="other"><pre>if exist keepalive.txt goto done
time /t &gt; keepalive.txt
REM Workaround for JDBC keep alive on SQL Azure
REG ADD HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v KeepAliveTime /t REG_DWORD /d 30000 &gt;&gt; keepalive.txt
REG ADD HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v KeepAliveInterval /t REG_DWORD /d 1000 &gt;&gt; keepalive.txt
REG ADD HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v TcpMaxDataRetransmission /t REG_DWORD /d 10 &gt;&gt; keepalive.txt
shutdown /r /t 1
:done</pre></span></div></dd><dt>Ajout du nom de serveur à l'ID d'utilisateur dans la chaîne de connexion</dt><dd><p>Avant la version 4.0 de Pilote JDBC Microsoft pour SQL Server, lors de la connexion à une base de données SQL Azure, vous deviez ajouter le nom du serveur à l'ID d'utilisateur dans la chaîne de connexion. Par exemple, utilisateur@nomserveur. À partir de la version 4.0 de Pilote JDBC Microsoft pour SQL Server, il n'est plus nécessaire d'ajouter @nomserveur à l'ID d'utilisateur dans la chaîne de connexion.</p></dd><dt>Utilisation du chiffrement, nécessitant la définition d'un hostNameInCertificate</dt><dd><p>Lors de la connexion à SQL Azure, vous devez spécifier <span sdata="langKeyword" value="hostNameInCertificate"><span class="keyword">hostNameInCertificate</span></span> si vous spécifiez <span sdata="langKeyword" value="encrypt=true"><span class="keyword">encrypt=true</span></span>. (Si le nom du serveur dans la chaîne de connexion est <span class="parameter" sdata="paramReference">shortName</span>.<span class="parameter" sdata="paramReference">domainName</span>, définissez la propriété <span sdata="langKeyword" value="hostNameInCertificate"><span class="keyword">hostNameInCertificate</span></span> sur *.<span class="parameter" sdata="paramReference">domainName</span>.)</p><p>Par exemple :</p><div class="sampleCode"><span codeLanguage="other"><pre>jdbc:sqlserver://abcd.int.mscds.com;databaseName= myDatabase;user=myName;password=myPassword;encrypt=true;hostNameInCertificate= *.int.mscds.com;</pre></span></div></dd></dl></div><span id="seeAlsoSpan"><h1 class="heading">Voir aussi</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connexion à SQL Server à l'aide du pilote JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envoyez vos <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dMerci pour vos commentaires qui permettent aux équipes chargées de rédiger la documentation développeur d\'en améliorer la qualité. Pendant la révision de vos commentaires, il est possible que nous vous contactions par courrier électronique afin de vous demander des éclaircissements ou d\'autres commentaires sur la solution envisagée. Nous n\'utilisons pas votre adresse de messagerie dans un autre but et nous la supprimons une fois notre révision terminée.%0\APour plus d\'informations sur les politiques de confidentialité de Microsoft, consultez http://privacy.microsoft.com/fr-fr/default.aspx.%0\A%0\d','Commentaires client.');">commentaires</a> sur cette rubrique à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tous droits réservés.</a></p></span></div></div></body></html>