<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Utilisation de l'authentification intégrée Kerberos pour se connecter à SQL Server</title><meta name="Language" content="fr-fr" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="Grâce au Pilote JDBC 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Utilisation de l'authentification intégrée Kerberos pour se connecter à SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Grâce au Pilote JDBC 4.0 Microsoft pour SQL Server, les applications peuvent désormais utiliser la propriété de connexion <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> pour indiquer qu'elles souhaitent se connecter à une base de données à l'aide de l'authentification intégrée Kerberos de type 4. Pour plus d'informations sur les propriétés de connexion, consultez <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Définition des propriétés de connexion</a></span>. Pour plus d'informations sur Kerberos, consultez <a href="http://go.microsoft.com/fwlink/?LinkId=101449">Supplément technique Kerberos pour Windows</a> et <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>.</p><p>Lors de l'utilisation de l'authentification intégrée avec le <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> Java, vous pouvez configurer le module à l'aide de la <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">classe Krb5LoginModule</a>.</p><p>Le Pilote JDBC Microsoft pour SQL Server permet de définir les propriétés suivantes pour les machines virtuelles Java IBM :</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>Le Pilote JDBC Microsoft pour SQL Server permet de définir les propriétés suivantes pour toutes les autres machines virtuelles Java :</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">Notes</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Dans les versions antérieures au Pilote JDBC 4.0 Microsoft pour SQL Server, les applications pouvaient spécifier l'authentification intégrée (à l'aide de Kerberos ou NTLM, en fonction de celui qui était disponible) en utilisant la propriété de connexion <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> et en référençant <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, tel que décrit dans <span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">Création de l'URL de connexion</a></span>.</p><p>Grâce au Pilote JDBC 4.0 Microsoft pour SQL Server, les applications peuvent désormais utiliser la propriété de connexion <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> pour indiquer qu'elles souhaitent se connecter à une base de données à l'aide de l'authentification intégrée Kerberos et de l'implémentation pure Kerberos Java :</p><ul><li><p>Si vous souhaitez que l'authentificaton intégrée utilise <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, vous devez malgré tout spécifier la propriété de connexion <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>. Il vous faut alors également spécifier la propriété de connexion <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>.</p></li><li><p>Pour continuer à utiliser l'authentification intégrée avec <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, il vous suffit de spécifier la propriété de connexion <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> (et éventuellement <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>).</p></li><li><p>Si vous spécifiez <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> sans spécifier <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>, le pilote ignorera la propriété de connexion <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> et s'attendra à trouver le nom d'utilisateur et les informations d'identification dans la chaîne de connexion.</p></li></ul><p>Lorsque vous utilisez une source de données pour créer des connexions, vous avez la possibilité de définir par programme le schéma d'authentification à l'aide de <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a>.</p><p>Un nouvel enregistreur d'événements a été ajouté pour la prise en charge de l'authentification Kerberos : com.microsoft.sqlserver.jdbc.internals.KerbAuthentication. Pour plus d'informations, consultez <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Suivi du fonctionnement du pilote</a></span>.</p><p>Les consignes suivantes vous aideront à configurer Kerberos :</p><ol><li><p>Attribuez la valeur 1 à <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> dans le Registre Windows. Pour plus d'informations, consultez <a href="http://support.microsoft.com/kb/837361">Entrées de Registre du protocole Kerberos et clés de configuration KDC dans Windows Server 2003</a>.</p></li><li><p>Assurez-vous que la configuration Kerberos (krb5.conf dans les environnements UNIX) référence le bon domaine et le centre de distribution de clés (KDC) convenant à votre environnement.</p></li><li><p>Initialisez le cache des tickets TGT à l'aide de l'outil kinit, en vous connectant au domaine.</p></li><li><p>Lorsqu'une application utilisant <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> est exécutée sur les systèmes d'exploitation Windows Vista ou Windows 7, vous devez utiliser un compte utilisateur standard. Toutefois, si vous exécutez l'application à l'aide d'un compte d'administrateur, vous devrez l'exécuter à l'aide de privilèges administrateur.</p></li></ol></div><h1 class="heading">Noms des principaux du service</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Un nom de principal du service (SPN) est le nom par lequel un client identifie une instance de service de manière unique. Pour plus d'informations sur les noms des principaux du service (SPN), consultez :</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">Utilisation de l'authentification Kerberos avec SQL Server</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">Utilisation de Kerberos avec SQL Server</a></p></li></ul></div><h1 class="heading">Création d'un fichier de configuration d'un module de connexion</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Vous pouvez, si vous le désirez, créer un fichier de configuration Kerberos. Si vous ne spécifiez pas de fichier de configuration, les paramètres suivants seront appliqués :</p><dl class="authored"><dt>Machine virtuelle Java Sun</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>Machine virtuelle Java IBM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>Si vous décidez de créer un fichier de configuration de module de connexion, le fichier doit respecter le format suivant :</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>Un fichier de configuration de connexion est composé d'une ou plusieurs entrées, chacune spécifiant la technologie d'authentification sous-jacente qui doit être utilisée pour une application en particulier. Exemple :</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>Chaque entrée de fichier de configuration de module de connexion correspond à un nom suivi d'une ou de plusieurs entrées spécifiques à LoginModule, où chaque entrée spécifique à LoginModule est suivie d'un point-virgule et où la totalité des entrées spécifiques à LoginModule est comprise entre accolades. Chaque entrée du fichier de configuration se termine par un point-virgule.</p><p>En plus de permettre au pilote d'acquérir les informations d'identification Kerberos à l'aide des paramètres spécifiés dans le fichier de configuration du module de connexion, le pilote peut utiliser les informations d'identification existantes. Cela peut se révéler utile si votre application doit créer des connexions utilisant les informations d'identification de plusieurs utilisateurs.</p><p>Le pilote tentera d'utiliser les informations d'identification existantes si disponibles, avant de tenter de se connecter au module de connexion spécifié. Par conséquent, lorsque vous utilisez la méthode Subject.doAs pour exécuter le code dans un contexte particulier, une connexion sera créée avec les informations d'identification transmises à l'appel Subject.doAs.</p><p>Pour plus d'informations, consultez <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">JAAS Login Configuration File (en anglais)</a> et <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">Class Krb5LoginModule (en anglais)</a>.</p></div><h1 class="heading">Création d'un fichier de configuration Kerberos</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Pour plus d'informations sur les fichiers de configuration Kerberos, consultez <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Kerberos Requirements (en anglais)</a>.</p><p>Voici un exemple de fichier de configuration de domaine, où YYYY et ZZZZ correspondent aux noms de domaine de votre site.</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">Activation du fichier de configuration de domaine et du fichier de configuration du module de connexion</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Le fichier de configuration de domaine peut être activé à l'aide de -Djava.security.krb5.conf. Le fichier de configuration du module de connexion peut être activé à l'aide de <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span>.</p><p>Par exemple, lorsque vous démarrez votre application, vous pouvez utiliser la ligne de commande suivante :</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Vérification de l'accessibilité de SQL Server via Kerberos</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Exécutez la requête suivante dans SQL Server Management Studio :</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>Assurez-vous de disposer de l'autorisation nécessaire pour exécuter cette requête.</p></div><span id="seeAlsoSpan"><h1 class="heading">Voir aussi</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connexion à SQL Server à l'aide du pilote JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envoyez vos <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dMerci pour vos commentaires qui permettent aux équipes chargées de rédiger la documentation développeur d\'en améliorer la qualité. Pendant la révision de vos commentaires, il est possible que nous vous contactions par courrier électronique afin de vous demander des éclaircissements ou d\'autres commentaires sur la solution envisagée. Nous n\'utilisons pas votre adresse de messagerie dans un autre but et nous la supprimons une fois notre révision terminée.%0\APour plus d\'informations sur les politiques de confidentialité de Microsoft, consultez http://privacy.microsoft.com/fr-fr/default.aspx.%0\A%0\d','Commentaires client.');">commentaires</a> sur cette rubrique à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tous droits réservés.</a></p></span></div></div></body></html>