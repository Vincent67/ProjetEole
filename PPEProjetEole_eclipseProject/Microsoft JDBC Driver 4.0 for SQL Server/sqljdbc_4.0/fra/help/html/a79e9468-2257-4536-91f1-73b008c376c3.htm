<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Accès aux informations de diagnostic dans le journal des événements étendus</title><meta name="Language" content="fr-fr" /><meta name="Microsoft.Help.Id" content="a79e9468-2257-4536-91f1-73b008c376c3" /><meta name="Description" content="Dans Pilote JDBC 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Accès aux informations de diagnostic dans le journal des événements étendus</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Dans Pilote JDBC 4.0 Microsoft pour SQL Server, le suivi (<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Suivi du fonctionnement du pilote</a></span>) a été mis à jour pour faciliter la corrélation d'événements clients avec des informations de diagnostic, comme les échecs de connexion, à partir de la mémoire tampon de l'anneau de connectivité du serveur et des informations relatives aux performances dans le journal des événements étendus. Pour plus d'informations sur la lecture du journal des événements étendus, consultez <a href="http://msdn.microsoft.com/en-us/library/hh710068(SQL.110).aspx ">Afficher les données de session d'événements</a>.</p></div><h1 class="heading">Détails</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Pour les opérations de connexion, Pilote JDBC Microsoft pour SQL Server envoie un ID de connexion client. Si la connexion échoue, vous pouvez accéder à la mémoire tampon de l'anneau de connectivité (<a href="http://go.microsoft.com/fwlink/?LinkId=207752">Résolution des problèmes de connectivité dans SQL Server 2008 avec la mémoire tampon de l'anneau de connectivité</a>) et consulter le champ <span sdata="langKeyword" value="ClientConnectionID"><span class="keyword">ClientConnectionID</span></span> pour obtenir les informations de diagnostic sur l'échec de connexion. Les ID de connexion clients sont consignés dans la mémoire tampon de l'anneau uniquement si une erreur se produit. (Si une connexion échoue avant l'envoi du paquet de préconnexion, aucun ID de connexion client ne sera généré.) L'ID de connexion client est un GUID 16 octets. Vous pouvez également trouver l'ID de connexion client dans la sortie cible des événements étendus, si l'action <span sdata="langKeyword" value="client_connection_id"><span class="keyword">client_connection_id</span></span> est ajoutée aux événements dans une sessions d'événements étendus. Vous pouvez activer le suivi et re-exécuter la commande de connexion, puis observer le champ <span sdata="langKeyword" value="ClientConnectionID"><span class="keyword">ClientConnectionID</span></span> dans la trace si vous avez besoin d'une assistance supplémentaire pour diagnostiquer le pilote client.</p><p>Vous pouvez obtenir l'ID de connexion du client par programmé à l'aide de <span sdata="link"><a href="031c01e2-2c65-4fe4-9700-fdbcc7a39f30.htm">Interface ISQLServerConnection</a></span>. L'ID de connexion sera également présent dans toutes les exceptions liées à la connexion.</p><p>En cas d'erreur de connexion, l'ID de connexion client dans les informations de trace BID du serveur et dans la mémoire tampon de l'anneau de connectivité peuvent aider à corréler les connexions du client aux connexions sur le serveur. Pour plus d'informations sur les traces BID, consultez <a href="http://go.microsoft.com/fwlink/?LinkId=125805">Traçage de l'accès aux données</a>. Notez que cet article contient également des informations sur la la création d'une trace d'accès aux données qui ne s'appliquent pas à Pilote JDBC Microsoft pour SQL Server ; reportez-vous à la rubrique <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Suivi du fonctionnement du pilote</a></span> pour plus d'informations sur la création d'une trace d'accès aux données à l'aide de Pilote JDBC Microsoft pour SQL Server.</p><p>Le pilote JDBC envoie également un ID d'activité spécifique au thread. L'ID de l'activité est capturé dans les sessions d'événements étendus si celles-ci sont démarrées avec l'option TRACK_CAUSAILITY activée. En cas de problèmes de performance avec une connexion active, vous pouvez obtenir l'ID d'activité de la trace du client (champ ActivityID), puis le localiser dans la sortie d'événements étendus. L'ID d'activité dans les événements étendus est un GUID à 16 octets (différent du GUID de l'ID de connexion du client) accompagné d'un numéro séquentiel de 4 octets. Le numéro séquentiel représente l'ordre d'une demande dans un thread. L'ActivityId est envoyé pour les instructions de lot SQL et les requêtes RPC. Pour activer l'envoi d'ActivityId au serveur, vous devez d'abord spécifier la paire de valeur/clé suivante dans le fichier Logging.Properties :</p><div class="sampleCode"><span codeLanguage="other"><pre>com.microsoft.sqlserver.jdbc.traceactivity = on</pre></span></div><p>Pour plus d'informations, consultez <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Suivi du fonctionnement du pilote</a></span>. L'indicateur de trace est utilisé avec les enregistreurs d'objets JDBC correspondants pour décider s'il faut tracer et envoyer l'ActivityId dans le pilote JDBC. En plus de la mise à jour du fichier Logging.Properties, l'enregistreur com.microsoft.sqlserver.jdbc doit être activé avec le niveau FINER ou plus élevé. Si vous souhaitez envoyer ActivityId au serveur pour des requêtes effectuées par une classe donnée, l'enregistreur de classe correspondant doit être activé avec le niveau FINER ou FINEST. Par exemple, si la classe est SQLServerStatement, activez l'enregistreur com.microsoft.sqlserver.jdbc.SQLServerStatement.</p><p>Voici un exemple qui utilise Transact-SQL pour démarrer une session d'événements étendus qui sera stockée dans une mémoire tampon de l'anneau et enregistrera l'ID d'activité envoyé par un client lors des opérations par lot et RPC.</p><div class="sampleCode"><span codeLanguage="other"><pre>create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)</pre></span></div></div><span id="seeAlsoSpan"><h1 class="heading">Voir aussi</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="723e2680-a0c5-4a7d-a319-1e49e41078cf.htm">Diagnostic de problèmes avec le pilote JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envoyez vos <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dMerci pour vos commentaires qui permettent aux équipes chargées de rédiger la documentation développeur d\'en améliorer la qualité. Pendant la révision de vos commentaires, il est possible que nous vous contactions par courrier électronique afin de vous demander des éclaircissements ou d\'autres commentaires sur la solution envisagée. Nous n\'utilisons pas votre adresse de messagerie dans un autre but et nous la supprimons une fois notre révision terminée.%0\APour plus d\'informations sur les politiques de confidentialité de Microsoft, consultez http://privacy.microsoft.com/fr-fr/default.aspx.%0\A%0\d','Commentaires client.');">commentaires</a> sur cette rubrique à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tous droits réservés.</a></p></span></div></div></body></html>